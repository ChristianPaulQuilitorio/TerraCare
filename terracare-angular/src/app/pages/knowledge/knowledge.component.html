<app-navbar />

<main class="knowledge-page">
  <aside class="kc-sidebar">
    <nav class="kc-nav">
      <ul>
  <li [class.active]="activeFilter==='All'" (click)="setFilter('All')">Home</li>
        <li [class.active]="activeFilter==='Articles'" (click)="setFilter('Articles')">Articles</li>
        <li [class.active]="activeFilter==='Videos'" (click)="setFilter('Videos')">Videos</li>
        <li [class.active]="activeFilter==='Guides'" (click)="setFilter('Guides')">Guides</li>
        <li [class.active]="activeFilter==='Infographics'" (click)="setFilter('Infographics')">Infographics</li>
      </ul>
    </nav>
    <div class="kc-subscriptions">
      <h4>Topics</h4>
      <div class="chips">
        <button class="chip" [class.active]="activeFilter==='All'" (click)="setFilter('All')">All</button>
        <button class="chip" [class.active]="activeFilter==='Waste'" (click)="setFilter('Waste')">Waste</button>
        <button class="chip" [class.active]="activeFilter==='Energy'" (click)="setFilter('Energy')">Energy</button>
        <button class="chip" [class.active]="activeFilter==='Transport'" (click)="setFilter('Transport')">Transport</button>
        <button class="chip" [class.active]="activeFilter==='Biodiversity'" (click)="setFilter('Biodiversity')">Biodiversity</button>
      </div>
    </div>
  </aside>

  <section class="kc-content">
    <header class="kc-header">
      <h1>Knowledge Hub</h1>
      <p class="subtitle">Explore articles, videos, guides, and infographics on sustainability.</p>
    </header>

    <div class="kc-controls">
      <div class="chips">
        <button class="chip" [class.active]="activeFilter==='All'" (click)="setFilter('All')">All</button>
        <button class="chip" [class.active]="activeFilter==='Latest'" (click)="setFilter('Latest')">Latest</button>
        <button class="chip" [class.active]="activeFilter==='Popular'" (click)="setFilter('Popular')">Popular</button>
        <button class="chip" [class.active]="activeFilter==='Recommended'" (click)="setFilter('Recommended')">Recommended</button>
      </div>
      <div class="controls-actions">
        <button class="btn" (click)="showUploadForm = !showUploadForm">{{ showUploadForm ? 'Cancel' : 'Add Resource' }}</button>
      </div>
    </div>

    <!-- Upload form (inline) -->
    <div class="upload-panel" *ngIf="showUploadForm">
      <div class="upload-grid">
        <div class="upload-fields">
          <input class="input" placeholder="Title" [value]="uploadTitle" (input)="uploadTitle = $any($event.target).value" />
          <textarea class="textarea" placeholder="Short description" (input)="uploadDescription = $any($event.target).value">{{ uploadDescription }}</textarea>
          <div class="row">
            <select class="select" (change)="uploadCategory = $any($event.target).value">
              <option value="Articles">Articles</option>
              <option value="Videos">Videos</option>
              <option value="Guides">Guides</option>
              <option value="Infographics">Infographics</option>
            </select>
            <input type="file" accept="image/*,video/*,application/pdf" (change)="onFileSelected($event)" />
          </div>
          <div class="actions-row">
            <button class="btn primary" (click)="submitUpload()" [disabled]="uploadLoading">{{ uploadLoading ? 'Uploading...' : 'Publish' }}</button>
            <button class="btn" (click)="resetUploadForm()" [disabled]="uploadLoading">Reset</button>
          </div>
          <p class="muted" *ngIf="uploadError">{{ uploadError }}</p>
        </div>
        <div class="upload-preview">
          <p *ngIf="!previewUrl && !selectedFile">No file selected</p>
          <img *ngIf="previewUrl" [src]="previewUrl" alt="preview" />
          <p *ngIf="selectedFile && !previewUrl">Selected: {{ selectedFile.name }}</p>
        </div>
      </div>
    </div>

    <section class="kc-hero" *ngIf="filteredItems && filteredItems.length">
      <div class="hero-card" (click)="openItem(filteredItems[0])" role="button" tabindex="0" (keyup.enter)="openItem(filteredItems[0])">
        <div class="hero-thumb" [style.backgroundImage]="'url(' + (filteredItems[0].image || '/assets/ecolife-bg.jpg') + ')'"></div>
        <div class="hero-body">
          <h2>{{ filteredItems[0].title }}</h2>
          <p>{{ filteredItems[0].description }}</p>
        </div>
      </div>
    </section>

    <section class="kc-grid">
      <p *ngIf="loading">Loading...</p>
      <p *ngIf="!loading && items?.length === 0" class="error">No knowledge items available right now.</p>

      <div class="thumb-grid">
        <article class="thumb-card" *ngFor="let item of filteredItems" (click)="openItem(item)" role="button" tabindex="0" (keyup.enter)="openItem(item)">
          <div class="thumb-image" [style.backgroundImage]="'url(' + (item.image || '/assets/ecolife-bg.jpg') + ')'">
            <div class="play-overlay">▶</div>
          </div>
          <div class="thumb-meta">
            <h3>{{ item.title }}</h3>
            <p class="muted">{{ item.description }}</p>
          </div>
        </article>
      </div>
    </section>
  </section>
</main>

<!-- Modal for item details -->
<div class="modal-backdrop kc-modal-backdrop" *ngIf="selectedItem">
  <div class="kc-modal" role="dialog" aria-modal="true" tabindex="-1">
    <header class="kc-modal-header">
      <h3>{{ selectedItem.title }}</h3>
      <button class="close" (click)="closeItem()">✕</button>
    </header>
    <div class="kc-modal-body">
  <div class="thumb-image large" [style.backgroundImage]="'url(' + (selectedItem.image || '/assets/ecolife-bg.jpg') + ')'"></div>
  <p>{{ selectedItem.description }}</p>
    </div>
    <footer class="kc-modal-footer">
      <button class="btn" (click)="closeItem()">Close</button>
    </footer>
  </div>
</div>
