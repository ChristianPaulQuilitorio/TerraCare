<main class="knowledge-page mat-app-background">
  <div class="kc-flex-layout">
    <section class="kc-main" style="width:100%">
      <header class="kc-header">
        <h1 class="desktop-title" *ngIf="!isHandset">Knowledge Hub</h1>
        <p class="subtitle">Explore articles, videos, guides, and infographics on sustainability.</p>
        <div class="header-actions">
          <button mat-stroked-button color="primary" (click)="openUploadDialog()">Add Resource</button>
        </div>
      </header>

      <!-- Inline filters under the header -->
      <section class="kc-filters">
        <div class="filters-row">
          <span class="filters-label">Categories</span>
          <mat-chip-listbox aria-label="Categories" class="filters-chips">
            <mat-chip-option (click)="setFilter('All')" [selected]="activeFilter==='All'">All</mat-chip-option>
            <mat-chip-option (click)="setFilter('Articles')" [selected]="activeFilter==='Articles'">Articles</mat-chip-option>
            <mat-chip-option (click)="setFilter('Videos')" [selected]="activeFilter==='Videos'">Videos</mat-chip-option>
            <mat-chip-option (click)="setFilter('Guides')" [selected]="activeFilter==='Guides'">Guides</mat-chip-option>
            <mat-chip-option (click)="setFilter('Infographics')" [selected]="activeFilter==='Infographics'">Infographics</mat-chip-option>
          </mat-chip-listbox>
        </div>
        <div class="filters-row">
          <span class="filters-label">Topics</span>
          <mat-chip-listbox aria-label="Topics" class="filters-chips">
            <mat-chip-option (click)="setFilter('All')" [selected]="activeFilter==='All'">All</mat-chip-option>
            <mat-chip-option (click)="setFilter('Waste')" [selected]="activeFilter==='Waste'">Waste</mat-chip-option>
            <mat-chip-option (click)="setFilter('Energy')" [selected]="activeFilter==='Energy'">Energy</mat-chip-option>
            <mat-chip-option (click)="setFilter('Transport')" [selected]="activeFilter==='Transport'">Transport</mat-chip-option>
            <mat-chip-option (click)="setFilter('Biodiversity')" [selected]="activeFilter==='Biodiversity'">Biodiversity</mat-chip-option>
          </mat-chip-listbox>
        </div>
      </section>
      <section class="kc-grid">
        <p class="muted" *ngIf="activeFilter !== 'All'" style="margin:4px 0 8px; text-align:center;">Filter "{{ activeFilter }}" is active — newly published items might be hidden if they don't match.</p>
        <p *ngIf="loading">Loading...</p>
        <p *ngIf="!loading && items.length === 0" class="error">No knowledge items available right now.</p>
        <div class="thumb-grid">
          <mat-card class="thumb-card" *ngFor="let item of filteredItems" (click)="openItem(item)" tabindex="0" (keyup.enter)="openItem(item)">
            <div class="thumb-image"
                 [style.backgroundImage]="'url(' + ((item.type?.startsWith('image/') && item.url) ? item.url : (item.image || 'assets/ecolife-bg.jpg')) + ')'">
              <div class="play-overlay">▶</div>
            </div>
            <div class="thumb-meta">
              <h3>{{ item.title }}</h3>
              <p class="muted">{{ item.description }}</p>
              <p class="muted" *ngIf="item.displayName || item.user_id">by {{ item.displayName || (item.user_id | slice:0:8) }}</p>
            </div>
          </mat-card>
        </div>
      </section>
    </section>
  </div>
</main>
